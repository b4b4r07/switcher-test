#!/bin/zsh

__import "core/core"
__import "print/print"
__import "job/spinner"

local    is_verbose=false
local    line
local -A zspec
local -a fail args

while (( $# > 0 ))
do
    case "$1" in
        --verbose)
            is_verbose=true
            ;;
        -*|--*)
            __die "$1: Unknown option\n"
            return 1
            ;;
        *)
            args+=("$1")
            ;;
    esac
    shift
done

for line in ${(u)${args[@]:gs:@::}}
do
    zspec=( ${(@f)"$(__parser__ "$line")"} )
    case "$zspec[from]" in
        "local")
            continue
            ;;
        "oh-my-zsh")
            if [[ ! -d ${zspec[dir]:h} ]]; then
                fail+=("$zspec[name]")
            fi
            ;;
        *)
            if [[ ! -d $zspec[dir] ]]; then
                fail+=("$zspec[name]")
            fi
            ;;
    esac
done

if (( $#fail > 0 )); then
    if $is_verbose; then
        __put "- $fg[red]%s$reset_color: not installed\n" "${(@nO)fail}"
    fi
    return 1
else
    return 0
fi
